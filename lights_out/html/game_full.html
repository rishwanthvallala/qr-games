<!DOCTYPE html>
<html>

<head>
    <meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1">
    <title>Lights Out</title>
    <style>
        body,
        #c,
        #g,
        .l,
        #s {
            display: flex;
            background: #222
        }
        
        body,
        #c,
        .l {
            align-items: center;
            gap: 10px
        }
        
        body {
            font: 1em monospace;
            flex-direction: column;
            color: #0f0
        }
        
        #s {
            padding: 10px;
            color: #0f0;
            background: #222;
        }
        
        #g {
            display: grid;
            gap: 5px
        }
        
        .l {
            width: 50px;
            height: 50px;
            border: 2px solid #777;
            justify-content: center;
            font-size: 24px
        }
        
        .n {
            color: #0ff
        }
        
        .w {
            position: relative;
            width: 60px;
            height: 34px
        }
        
        .r {
            position: absolute;
            inset: 0;
            background: #ccc;
            border-radius: 34px
        }
        
        .r:before {
            content: "";
            position: absolute;
            height: 26px;
            width: 26px;
            left: 4px;
            bottom: 4px;
            background: #fff;
            border-radius: 50%
        }
        
        input:checked+.r:before {
            transform: translateX(26px)
        }
        
        p {
            color: #888;
            font-style: italic;
            margin-top: 15px
        }
    </style>
</head>

<body>
    <h1 id="t">Lights Out</h1>
    <div id=c><label class=w><input type=checkbox id=m><span class=r></span></label><span id=b>Solvable</span></div>
    <div id=g></div><button id=s>RESET</button>
    <p id="h">Make all lights the same (all ON or all OFF) to win!</p>
    <script>
        let d = document,
            a = 5,
            e = [],
            g = id => d.getElementById(id),
            c = (e, c, t) => e.classList.toggle(c, t),
            r = Math.random,
            A = Array,
            S = 'style',
            T = 'textContent',
            z, D = v => ['c', 'g', 's', 'h'].forEach(q => g(q)[S].display = v),
            f = (x, y) => (x >= 0 && x < a && y >= 0 && y < a) && (e[x][y] = !e[x][y], l = g(`l-${x}-${y}`), l[T] = e[x][y] ? 1 : 0, c(l, 'n', e[x][y])),
            i = (x, y) => {
                f(x, y), f(x - 1, y), f(x + 1, y), f(x, y - 1), f(x, y + 1);
                const b = e.flat();
                if (new Set(b).size < 2) {
                    g('t')[T] = 'WIN!';
                    D('none');
                    let B = d.createElement('button');
                    B[T] = 'AGAIN';
                    B.id = 's';
                    B.onclick = () => {
                        g('t')[T] = 'Lights Out';
                        D('');
                        d.body.removeChild(B);
                        R()
                    };
                    d.body.appendChild(B)
                }
            },
            j = k => {
                let l = g('g');
                l[T] = '';
                l[S].gridTemplateColumns = `repeat(${a},50px)`;
                e = [...A(a)].map(() => A(a).fill(0));
                e.forEach((_, x) => e.forEach((_, y) => {
                    let h = d.createElement('div');
                    h.id = `l-${x}-${y}`;
                    h.className = 'l';
                    h[T] = 0;
                    h.onclick = () => i(x, y);
                    l.appendChild(h)
                }));
                if (!k) f(0, 0);
                for (z = 10; z--;) i(~~(r() * a), ~~(r() * a))
            },
            R = () => (j(!g('m').checked), g('b')[T] = g('m').checked ? 'Unsolvable' : 'Solvable');
        g('s').onclick = R;
        g('m').onchange = R;
        j(1)
    </script>
</body>

</html>